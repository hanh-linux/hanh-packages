name=iwd
ver=1.6
desc="Lightweight internet wireless daemon"
home="https://iwd.wiki.kernel.org/"
license="LGPL"
makedeps="linux-headers dbus libedit"
build_bin="autoconf automake libtool"
sources="https://mirrors.edge.kernel.org/pub/linux/network/wireless/iwd-$ver.tar.gz"
needed="$name-$ver.tar.gz 0001-libedit.patch"
_args="--prefix=/usr --sysconfdir=/etc --disable-systemd-service"


unpack-pkg() {
cd $workdir
tar -xf $hanhdir/$name-$ver.tar.gz
cd $name-$ver
sed 's+readline/readline.h+editline/readline.h+g' -i configure.ac
patch -Np0 < $hanhdir/0001-libedit.patch
autoreconf -fiv
}

compile-pkg() {
cd $workdir/$name-$ver
eval ./configure $_args
LDFLAGS="$LDFLAGS -ledit" make
}

compile-pkg_full() {
contain="ead"
echo contain=\"ead\" >> $hanhdir/.buildinfo
_args="$_args --enable-sim-hardcoded --enable-wired --enable-tools"
compile-pkg
}

make-pkg() {
cd $workdir/$name-$ver
make DESTDIR=$pkgdir install
install -dm755 $pkgdir/etc/init.d/ 
install -Dm755 $hanhdir/iwd.initd $pkgdir/etc/init.d/iwd
install -dm755 $pkgdir/etc/conf.d/
install -Dm755 $hanhdir/iwd.confd $pkgdir/etc/conf.d/iwd
}
